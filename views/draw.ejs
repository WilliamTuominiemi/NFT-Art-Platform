<html lang="en">
    <body>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>
            // create canvas element and append it to document body
            var canvas = document.createElement('canvas');
            document.body.appendChild(canvas);

            // some hotfixes... ( ≖_≖)
            document.body.style.margin = 0;
            canvas.style.position = 'fixed';

            // get canvas 2D context and set him correct size
            var ctx = canvas.getContext('2d');
            resize();

            // last known position
            var pos = { x: 0, y: 0 };

            window.addEventListener('resize', resize);
            document.addEventListener('mousemove', draw);
            document.addEventListener('mousedown', setPosition);
            document.addEventListener('mouseenter', setPosition);

            // new position from mouse event
            function setPosition(e) {
                pos.x = e.clientX;
                pos.y = e.clientY;
            }

            // resize canvas
            function resize() {
                ctx.canvas.width = 500;
                ctx.canvas.height = 500;
            }

            function draw(e) {
                // mouse left button must be pressed
                if (e.buttons !== 1) return;

                ctx.beginPath(); // begin

                ctx.lineWidth = 5;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#c0392b';

                ctx.moveTo(pos.x, pos.y); // from
                setPosition(e);
                ctx.lineTo(pos.x, pos.y); // to

                ctx.stroke(); // draw it!
            }  
            
            function toImage() {
                var img = canvas.toDataURL("image/png");

                var element = document.getElementById("src");;

                console.log(element)

                element.setAttribute("value", img);
            }       
        </script>
        
        <div id="capture">
            <canvas id="canvas" height="500px" width="500px" style="padding: 10px; border: 2px solid black;"></canvas>
        </div>

        
        
        <div id="image">
            <img id="painting"/>
        </div>

        <button onclick="toImage()">Save image</button>

        <div class="container">
            <form action="/image" method="POST">
                <div class="form-group">
                    <input type="hidden" id="src" value="" name="src" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-dark">Submit</button>
                </div>
            </form>
        </div>
    </body>
</html>
